<div [@expandCollapse]="state" class="overflowed">
    <div class="row">
        <mat-form-field subscriptSizing="dynamic">
            <button mat-icon-button matPrefix (click)="onSearchClicked(input, $event)">
                <mat-icon>{{ hideCharacters ? "arrow_back" : "search" }}</mat-icon>
            </button>
            <mat-label>Search</mat-label>
            <input
                matInput
                (input)="onSearch($event)"
                (focusin)="onToggleCharVisibility(true)"
                (focusout)="onToggleCharVisibility(false)"
                #input />
        </mat-form-field>
        <button mat-mini-fab (click)="where2SearchFn()">
            {{ where2Search }}
        </button>
    </div>
    @if (!hideCharacters) {
        @if (where2Search === "A") {
            <div class="chars">
                @for (char of alphabet; track $index) {
                    <button
                        mat-mini-fab
                        [disabled]="selectedCharacter === char"
                        (click)="changeSelectedChar(char, 'authors')">
                        <span>{{ char }}</span>
                    </button>
                }
            </div>
        } @else if (where2Search === "B") {
            <div class="chars">
                @for (char of ["liked", "started", "finished"]; track $index) {
                    <button
                        mat-fab extended
                        [disabled]="bookSearchBy === char"
                        (click)="changeSelectedChar(char, 'books')">
                        <span>{{ char }}</span>
                    </button>
                }
            </div>
        }
    }
</div>

<ion-content [scrollEvents]="true" (ionScrollStart)="onScrollStart($event)" (ionScrollEnd)="onScrollEnd($event)">
    <div class="boxes">
        @if (where2Search === "A") {
            @for (author of _authors; track author) {
                <div [routerLink]="['/author', author.id]" class="box">
                    <ion-avatar>
                        <img [src]="onGetImgSrc(author.img)" alt="img" />
                    </ion-avatar>

                    <div class="width">
                        @if (author.surname || author.name) {
                            <div class="column">
                                <span class="weighted">{{ author.surname || "" }}</span>
                                <span class="grayed">{{ author.name || "" }}</span>
                            </div>
                        } @else {
                            <span class="weighted">{{ author.pseudonym }}</span>
                        }
                        @if (author.progress) {
                            <mat-progress-bar mode="determinate" [value]="author.progress * 100"> </mat-progress-bar>
                        }
                    </div>
                </div>
            }
            <ion-infinite-scroll (ionInfinite)="onAuthorsIonInfinite($any($event))">
                <ion-infinite-scroll-content></ion-infinite-scroll-content>
            </ion-infinite-scroll>
        } @else if (where2Search === "B") {
            @for (book of _books; track book) {
                <div [routerLink]="['/book', book.id]" class="box">
                    <ion-avatar>
                        <img [src]="onGetImgSrc(book.img)" alt="img" />
                    </ion-avatar>

                    <div class="width">
                        <div class="column">
                            <span class="weighted">{{ book.title || "" }}</span>
                            <span class="grayed">{{ book.authors || "" }}</span>
                        </div>
                        @if (book.progress) {
                            <mat-progress-bar mode="determinate" [value]="book.progress | percent2: book.progress"> </mat-progress-bar>
                        }
                    </div>
                </div>
            }
            <ion-infinite-scroll (ionInfinite)="onBooksIonInfinite($any($event))">
                <ion-infinite-scroll-content></ion-infinite-scroll-content>
            </ion-infinite-scroll>
        }
    </div>

    <div class="bb">
        @if (lastListened) {
            <button mat-mini-fab (click)="onShowDialog()">
                <mat-icon>upload</mat-icon>
            </button>
        }
        <button mat-mini-fab (click)="onAddAuthor()">
            <mat-icon>add_circle</mat-icon>
        </button>
        @if (lastListened) {
            <button mat-mini-fab (click)="onGo2Last()">
                <mat-icon>play_arrow</mat-icon>
            </button>
        }
    </div>
</ion-content>
